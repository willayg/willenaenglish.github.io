<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Student Dashboard</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/students/dashboard.css" />
  <base href="/students/">
  <meta name="robots" content="noindex" />
  <script>
    // Redirect to login if not signed in
    document.addEventListener('DOMContentLoaded', async () => {
      try {
        const who = await fetch('/.netlify/functions/supabase_auth?action=whoami', { credentials: 'include' });
        const w = await who.json();
        if (!w.success) location.replace('/students/login.html?next=' + encodeURIComponent(location.pathname));
      } catch {}
    });
  </script>
  <script type="module" src="/students/components/student-header.js"></script>
</head>
<body>
  <student-header title="Dashboard" show-id="false" show-home="false" show-points="true"></student-header>
  <div class="wrap">
    <div class="cards">
      <!-- Your Homework -->
      <section class="card">
        <h2 class="card-title">Your Homework</h2>
        <div class="card-subtitle" id="dashboardClassName">Class</div>
        <div class="card-content homework-scroll">
          <table class="homework-table">
            <thead>
              <tr>
                <th>Title</th>
                <th>Teacher</th>
                <th>Due</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td style="color:#1a1a1a;">Unit 3 Words About sea animals</td>
                <td class="status-pink">William</td>
                <td class="status-pink">2025-10-9</td>
                <td class="status-pink">45%</td>
              </tr>
              <tr>
                <td style="color:#979b9b;">Unit 2 Phonics Long a</td>
                <td class="status-blue">William</td>
                <td class="status-blue">2025-10-9</td>
                <td class="status-blue">Done</td>
              </tr>
              <tr>
                <td style="color:#979b9b;">Lalal</td>
                <td class="status-blue">William</td>
                <td class="status-blue">2025-10-9</td>
                <td class="status-blue">Done</td>
              </tr>
              <tr>
                <td style="color:#1a1a1a;">Unit 4 Adjectives</td>
                <td class="status-pink">William</td>
                <td class="status-pink">2025-10-9</td>
                <td class="status-pink">80%</td>
              </tr>
              <tr>
                <td style="color:#979b9b;">Unit 5 Verbs</td>
                <td class="status-blue">William</td>
                <td class="status-blue">2025-10-9</td>
                <td class="status-blue">Done</td>
              </tr>
              <tr>
                <td style="color:#1a1a1a;">Unit 6 Nouns</td>
                <td class="status-pink">William</td>
                <td class="status-pink">2025-10-9</td>
                <td class="status-pink">60%</td>
              </tr>
              <tr>
                <td style="color:#979b9b;">Unit 7 Review</td>
                <td class="status-blue">William</td>
                <td class="status-blue">2025-10-9</td>
                <td class="status-blue">Done</td>
              </tr>
              <tr>
                <td style="color:#1a1a1a;">Unit 8 Challenge</td>
                <td class="status-pink">William</td>
                <td class="status-pink">2025-10-9</td>
                <td class="status-pink">10%</td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>

      <!-- Start Learning -->
      <section class="card">
        <h2 class="card-title">Start Learning</h2>
        <div class="card-content">
          <div class="learning-list">
            <a href="/Games/Word%20Arcade/index.html" class="learning-item word-arcade">Word Arcade</a>
            <a href="#" class="learning-item grammar-arcade">Grammar Arcade</a>
            <a href="/playzone.html" class="learning-item challenge-zone">Challenge Zone</a>
            <a href="/students/profile.html" class="learning-item my-profile">My Profile</a>
          </div>
        </div>
      </section>

      <!-- Settings -->
      <section class="card">
        <h2 class="card-title">Settings</h2>
        <div class="card-content">
          <div class="settings-list">
            <div class="settings-row">
              <span class="settings-label">Language</span>
              <span class="settings-muted">Korean</span>
              <span class="settings-switch"></span>
              <span class="settings-muted">English</span>
            </div>
            <div class="settings-row">
              <span class="settings-label">Dark Mode</span>
              <span class="settings-muted">Off</span>
              <span class="settings-switch"></span>
            </div>
            <div class="settings-row">
              <span class="settings-label">Music</span>
              <span class="settings-muted">Off</span>
              <span class="settings-switch"></span>
            </div>
          </div>
        </div>
      </section>

      <!-- Account -->
      <section class="card">
        <h2 class="card-title">Account</h2>
        <div class="card-content">
          <div class="account-list">
            <a href="#" class="account-link">Change Password</a>
            <a href="#" class="account-link">Change Email</a>
            <a href="/students/profile.html" class="account-link">View Profile</a>
            <a href="#" class="account-link">Logout</a>
          </div>
        </div>
      </section>
    </div>
  </div>
  <script>
    document.getElementById('logoutBig')?.addEventListener('click', async () => {
      await fetch('/.netlify/functions/supabase_auth?action=logout', { method:'POST', credentials:'include' });
      location.href = '/students/login.html';
    });
  </script>

  <script>
    (async () => {
      try {
        const el = document.getElementById('dashboardClassName');
        if (!el) return;
        // First try get_profile_name (returns class)
        let cls = null;
        try {
          const r1 = await fetch('/.netlify/functions/supabase_auth?action=get_profile_name', { credentials: 'include' });
          const j1 = await r1.json().catch(() => ({}));
          if (j1 && j1.class) cls = j1.class;
        } catch {}
        // Fallback to get_profile
        if (!cls) {
          try {
            const r2 = await fetch('/.netlify/functions/supabase_auth?action=get_profile', { credentials: 'include' });
            const j2 = await r2.json().catch(() => ({}));
            if (j2 && j2.class) cls = j2.class;
          } catch {}
        }
        if (cls && typeof cls === 'string') {
          el.textContent = `${cls} Class`;
        }
      } catch {}
    })();
  </script>
</body>
</html>
