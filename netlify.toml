# netlify.toml â€” production actually builds now

# Install core plugin for functions (fine to keep)
[[plugins]]
package = "@netlify/plugin-functions-install-core"

# Minimal temporary netlify.toml to validate Netlify parsing
[build]
  command = "npm ci"
  publish = "."

[functions]
  directory = "netlify/functions"

# Schedule daily stats population at 5:00 AM UTC every day
[functions."populate_daily_stats"]
  schedule = "0 5 * * *"

[dev]
  framework = "#static"
  port = 9000
  # Local dev proxy: route only the progress_summary function to the local
  # Cloudflare worker when testing. This preserves same-origin cookies so the
  # worker can observe the logged-in session during development.
  [[redirects]]
    from = "/.netlify/functions/progress_summary/*"
    to = "http://127.0.0.1:8790/.netlify/functions/progress_summary/:splat"
    status = 200
    force = true

# Production/proxy: route progress_summary to the Netlify proxy function,
# which forwards to the Cloudflare worker while keeping browser cookies intact.
[[redirects]]
  from = "/.netlify/functions/progress_summary/*"
  to = "/.netlify/functions/proxy_progress_summary/:splat"
  status = 200
  force = true
