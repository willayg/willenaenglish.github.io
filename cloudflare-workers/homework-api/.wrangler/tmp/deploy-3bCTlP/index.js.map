{
  "version": 3,
  "sources": ["../../../src/index.js"],
  "sourceRoot": "D:\\Willena Website\\willenaenglish.github.io\\cloudflare-workers\\homework-api\\.wrangler\\tmp\\deploy-3bCTlP",
  "sourcesContent": ["/**\r\n * Cloudflare Worker: homework-api\r\n * \r\n * Drop-in replacement for Netlify function homework_api.js\r\n * Uses Supabase REST API directly (no SDK required for Workers)\r\n * \r\n * IMPROVED MODE MATCHING:\r\n * - Handles spelling modes: spelling, spelling_test, spelling_practice, etc.\r\n * - Handles all vocab modes: flashcard, match, listen, unscramble, etc.\r\n * - Proper normalization of mode names for consistent counting\r\n * \r\n * API Actions:\r\n *   - create_assignment\r\n *   - create_run\r\n *   - get_run_token\r\n *   - list_assignments\r\n *   - end_assignment\r\n *   - assignment_progress\r\n *   - delete_assignment\r\n *   - link_sessions\r\n */\r\n\r\nconst ALLOWED_ORIGINS = [\r\n  'https://willenaenglish.com',\r\n  'https://www.willenaenglish.com',\r\n  'https://cf.willenaenglish.com',\r\n  'https://willenaenglish.netlify.app',\r\n  'https://willenaenglish.github.io',\r\n  'http://localhost:8888',\r\n  'http://localhost:9000',\r\n  'http://127.0.0.1:8888',\r\n  'http://127.0.0.1:9000',\r\n];\r\n\r\n// Known game modes - used to detect and normalize mode names\r\nconst VOCAB_MODES = [\r\n  'flashcard', 'match', 'listen', 'unscramble', \r\n  'spelling', 'spelling_test', 'spelling_practice', 'spell',\r\n  'translation', 'translation_choice', 'reverse_translation',\r\n  'typing', 'dictation', 'audio_match'\r\n];\r\n\r\nconst PHONICS_MODES = [\r\n  'phonics_listen', 'phonics_match', 'phonics_spell', 'phonics_unscramble'\r\n];\r\n\r\nconst GRAMMAR_MODES = [\r\n  'grammar_lesson', 'grammar_sorting', 'grammar_find_mistake', \r\n  'grammar_translation_choice', 'grammar_fill_blank', 'grammar_reorder'\r\n];\r\n\r\nfunction getCorsHeaders(origin) {\r\n  const allowed = ALLOWED_ORIGINS.includes(origin) ? origin : ALLOWED_ORIGINS[0];\r\n  return {\r\n    'Access-Control-Allow-Origin': allowed,\r\n    'Access-Control-Allow-Credentials': 'true',\r\n    'Access-Control-Allow-Methods': 'GET, POST, DELETE, OPTIONS',\r\n    'Access-Control-Allow-Headers': 'Content-Type, Authorization, Cookie',\r\n  };\r\n}\r\n\r\nfunction jsonResponse(status, body, origin) {\r\n  return new Response(JSON.stringify(body), {\r\n    status,\r\n    headers: {\r\n      'Content-Type': 'application/json',\r\n      ...getCorsHeaders(origin),\r\n    },\r\n  });\r\n}\r\n\r\nfunction parseCookies(cookieHeader) {\r\n  const cookies = {};\r\n  if (!cookieHeader) return cookies;\r\n  cookieHeader.split(/;\\s*/).forEach(pair => {\r\n    const idx = pair.indexOf('=');\r\n    if (idx > 0) {\r\n      const key = pair.slice(0, idx).trim();\r\n      const val = pair.slice(idx + 1).trim();\r\n      cookies[key] = decodeURIComponent(val);\r\n    }\r\n  });\r\n  return cookies;\r\n}\r\n\r\nfunction generateRunToken(assignmentId) {\r\n  const t = Date.now().toString(36);\r\n  const rand = Math.random().toString(36).slice(2, 8);\r\n  return `run_${assignmentId}_${t}_${rand}`;\r\n}\r\n\r\nfunction normalizeListIdentifier(value) {\r\n  if (!value) return '';\r\n  return String(value)\r\n    .toLowerCase()\r\n    .replace(/[^a-z0-9]+/g, ' ')\r\n    .trim()\r\n    .replace(/\\s+/g, ' ');\r\n}\r\n\r\n/**\r\n * Normalize mode name for consistent counting\r\n * Maps variations like 'spelling_test', 'spell', 'spelling_practice' -> 'spelling'\r\n */\r\nfunction normalizeModeName(mode) {\r\n  if (!mode) return 'unknown';\r\n  const m = String(mode).toLowerCase().trim();\r\n  \r\n  // Spelling variants\r\n  if (m.includes('spell') || m === 'spelling_test' || m === 'spelling_practice') {\r\n    return 'spelling';\r\n  }\r\n  \r\n  // Translation variants  \r\n  if (m.includes('translation') && !m.includes('grammar')) {\r\n    return 'translation';\r\n  }\r\n  \r\n  // Typing/dictation\r\n  if (m === 'typing' || m === 'dictation') {\r\n    return 'typing';\r\n  }\r\n  \r\n  // Return as-is for other modes\r\n  return m;\r\n}\r\n\r\n/**\r\n * Determine category from assignment info\r\n */\r\nfunction determineCategory(assignment) {\r\n  const text = `${assignment.list_key || ''} ${assignment.title || ''} ${assignment.list_title || ''}`.toLowerCase();\r\n  if (text.includes('phonics')) return 'phonics';\r\n  if (text.includes('grammar')) return 'grammar';\r\n  return 'vocab';\r\n}\r\n\r\n/**\r\n * Determine grammar level (1, 2, or 3) from list_key path\r\n */\r\nfunction determineGrammarLevel(listKey) {\r\n  if (!listKey) return 1;\r\n  const lk = listKey.toLowerCase();\r\n  if (lk.includes('/level3/') || lk.includes('level3')) return 3;\r\n  if (lk.includes('/level2/') || lk.includes('level2')) return 2;\r\n  return 1;\r\n}\r\n\r\n/**\r\n * Get total expected modes for grammar based on level and specific list\r\n * \r\n * Grammar Level 1 modes (4-5 modes depending on list):\r\n *   - lesson (How To Win)\r\n *   - choose (Choose)\r\n *   - fill_gap (Fill the Gap)\r\n *   - unscramble (Unscramble)\r\n *   Note: Some L1 lists may have fewer modes\r\n * \r\n * Grammar Level 2 modes (5 modes):\r\n *   - sorting (Sorting) - most lists\r\n *   - choose (Choose) - most lists\r\n *   - fill_gap (Fill the Gap)\r\n *   - unscramble (Unscramble)\r\n *   - find_mistake (Find the Mistake)\r\n *   - translation (Translation)\r\n *   Note: Preposition lists and WH lists have fewer modes (no sorting/choose)\r\n * \r\n * Grammar Level 3 modes (6 modes):\r\n *   - choose (Choose)\r\n *   - fill_gap (Fill the Gap)\r\n *   - unscramble (Unscramble)\r\n *   - sentence_order (Sentence Order)\r\n *   - find_mistake (Find the Mistake)\r\n *   - translation (Translation)\r\n */\r\nfunction getGrammarModeCount(listKey) {\r\n  if (!listKey) return 5;\r\n  const lk = listKey.toLowerCase();\r\n  const level = determineGrammarLevel(listKey);\r\n  \r\n  if (level === 3) {\r\n    // Level 3: 6 modes (choose, fill_gap, unscramble, sentence_order, find_mistake, translation)\r\n    return 6;\r\n  }\r\n  \r\n  if (level === 2) {\r\n    // Level 2: Check for special lists with fewer modes\r\n    // Preposition lists: no sorting, no choose \u2192 4 modes (fill_gap, unscramble, find_mistake, translation)\r\n    if (lk.includes('prepositions_')) return 4;\r\n    // WH lists: no sorting, no choose \u2192 4 modes\r\n    if (lk.includes('wh_who_what') || lk.includes('wh_where_when') || lk.includes('wh_how_why')) return 4;\r\n    // Present Simple WH Questions: no sorting \u2192 5 modes\r\n    if (lk.includes('present_simple_questions_wh')) return 5;\r\n    // Most L2 lists: 5 modes (sorting, choose, fill_gap, unscramble, find_mistake, translation)\r\n    // Actually many L2 don't have all - typically: sorting, choose, fill_gap, unscramble, find_mistake = 5\r\n    return 5;\r\n  }\r\n  \r\n  // Level 1: 4 modes (lesson, choose, fill_gap, unscramble)\r\n  // Some lists might not have all modes compatible\r\n  return 4;\r\n}\r\n\r\n/**\r\n * Get total expected modes for a category\r\n */\r\nfunction getExpectedModes(category, listKey, encounteredModes) {\r\n  if (category === 'phonics') return 4;\r\n  \r\n  if (category === 'grammar') {\r\n    return getGrammarModeCount(listKey);\r\n  }\r\n  \r\n  // Vocab: 6 modes (flashcard, match, listen, unscramble, spelling, translation)\r\n  return 6;\r\n}\r\n\r\n/**\r\n * Supabase REST API helper\r\n */\r\nclass SupabaseClient {\r\n  constructor(url, serviceKey) {\r\n    this.url = url;\r\n    this.serviceKey = serviceKey;\r\n  }\r\n\r\n  async query(table, options = {}) {\r\n    const { select = '*', filters = [], single = false, order, limit, method = 'GET', body } = options;\r\n    \r\n    let url = `${this.url}/rest/v1/${table}?select=${encodeURIComponent(select)}`;\r\n    \r\n    filters.forEach(f => {\r\n      url += `&${f.column}=${f.op}.${encodeURIComponent(f.value)}`;\r\n    });\r\n    \r\n    if (order) {\r\n      url += `&order=${order.column}.${order.ascending ? 'asc' : 'desc'}`;\r\n    }\r\n    \r\n    if (limit) {\r\n      url += `&limit=${limit}`;\r\n    }\r\n\r\n    const headers = {\r\n      'apikey': this.serviceKey,\r\n      'Authorization': `Bearer ${this.serviceKey}`,\r\n      'Content-Type': 'application/json',\r\n      'Prefer': single ? 'return=representation' : 'return=representation',\r\n    };\r\n\r\n    if (single) {\r\n      headers['Accept'] = 'application/vnd.pgrst.object+json';\r\n    }\r\n\r\n    const fetchOptions = { method, headers };\r\n    if (body && (method === 'POST' || method === 'PATCH')) {\r\n      fetchOptions.body = JSON.stringify(body);\r\n    }\r\n\r\n    const resp = await fetch(url, fetchOptions);\r\n    \r\n    if (!resp.ok) {\r\n      const errText = await resp.text();\r\n      throw new Error(`Supabase error ${resp.status}: ${errText}`);\r\n    }\r\n    \r\n    return resp.json();\r\n  }\r\n\r\n  async insert(table, data) {\r\n    const url = `${this.url}/rest/v1/${table}`;\r\n    const resp = await fetch(url, {\r\n      method: 'POST',\r\n      headers: {\r\n        'apikey': this.serviceKey,\r\n        'Authorization': `Bearer ${this.serviceKey}`,\r\n        'Content-Type': 'application/json',\r\n        'Prefer': 'return=representation',\r\n      },\r\n      body: JSON.stringify(data),\r\n    });\r\n    \r\n    if (!resp.ok) {\r\n      const errText = await resp.text();\r\n      throw new Error(`Insert error ${resp.status}: ${errText}`);\r\n    }\r\n    \r\n    const result = await resp.json();\r\n    return Array.isArray(result) ? result[0] : result;\r\n  }\r\n\r\n  async update(table, filters, data) {\r\n    let url = `${this.url}/rest/v1/${table}?`;\r\n    filters.forEach((f, i) => {\r\n      if (i > 0) url += '&';\r\n      url += `${f.column}=${f.op}.${encodeURIComponent(f.value)}`;\r\n    });\r\n    \r\n    const resp = await fetch(url, {\r\n      method: 'PATCH',\r\n      headers: {\r\n        'apikey': this.serviceKey,\r\n        'Authorization': `Bearer ${this.serviceKey}`,\r\n        'Content-Type': 'application/json',\r\n        'Prefer': 'return=representation',\r\n      },\r\n      body: JSON.stringify(data),\r\n    });\r\n    \r\n    if (!resp.ok) {\r\n      const errText = await resp.text();\r\n      throw new Error(`Update error ${resp.status}: ${errText}`);\r\n    }\r\n    \r\n    const result = await resp.json();\r\n    return Array.isArray(result) ? result[0] : result;\r\n  }\r\n\r\n  async getUserFromToken(token) {\r\n    const url = `${this.url}/auth/v1/user`;\r\n    const resp = await fetch(url, {\r\n      headers: {\r\n        'apikey': this.serviceKey,\r\n        'Authorization': `Bearer ${token}`,\r\n      },\r\n    });\r\n    \r\n    if (!resp.ok) return null;\r\n    return resp.json();\r\n  }\r\n}\r\n\r\n// ============================================================\r\n// ACTION HANDLERS\r\n// ============================================================\r\n\r\nasync function getUserIdFromCookie(request, supabase) {\r\n  const cookieHeader = request.headers.get('Cookie') || '';\r\n  const cookies = parseCookies(cookieHeader);\r\n  const token = cookies['sb_access'] || cookies['sb-access-token'] || cookies['sb_access_token'];\r\n  if (!token) return null;\r\n  \r\n  try {\r\n    const user = await supabase.getUserFromToken(token);\r\n    return user?.id || null;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\nasync function getProfile(supabase, userId) {\r\n  try {\r\n    return await supabase.query('profiles', {\r\n      select: 'id,role,approved,class,name,korean_name',\r\n      filters: [{ column: 'id', op: 'eq', value: userId }],\r\n      single: true,\r\n    });\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\nasync function handleCreateAssignment(request, supabase, origin) {\r\n  const userId = await getUserIdFromCookie(request, supabase);\r\n  if (!userId) {\r\n    return jsonResponse(401, { success: false, error: 'Not signed in' }, origin);\r\n  }\r\n\r\n  const prof = await getProfile(supabase, userId);\r\n  if (!prof || !['teacher', 'admin'].includes(String(prof.role || '').toLowerCase())) {\r\n    return jsonResponse(403, { success: false, error: 'Only teachers can create assignments' }, origin);\r\n  }\r\n  if (prof.approved === false) {\r\n    return jsonResponse(403, { success: false, error: 'Teacher not approved' }, origin);\r\n  }\r\n\r\n  let body;\r\n  try {\r\n    body = await request.json();\r\n  } catch {\r\n    return jsonResponse(400, { success: false, error: 'Invalid JSON body' }, origin);\r\n  }\r\n\r\n  const { class: className, title, description, list_key, list_title, list_meta, start_at, due_at, goal_type, goal_value } = body;\r\n\r\n  if (!className || !title || !list_key || !due_at) {\r\n    return jsonResponse(400, { success: false, error: 'Missing required fields: class, title, list_key, due_at' }, origin);\r\n  }\r\n\r\n  const autoToken = `run_auto_${Date.now().toString(36)}_${Math.random().toString(36).slice(2, 8)}`;\r\n  const initialMeta = {\r\n    ...(list_meta || {}),\r\n    run_tokens: [{ token: autoToken, created_at: new Date().toISOString(), auto: true }],\r\n  };\r\n\r\n  try {\r\n    const data = await supabase.insert('homework_assignments', {\r\n      class: className,\r\n      title,\r\n      description: description || null,\r\n      list_key,\r\n      list_title,\r\n      list_meta: initialMeta,\r\n      start_at: start_at || new Date().toISOString(),\r\n      due_at,\r\n      goal_type: goal_type || 'stars',\r\n      goal_value: goal_value || 5,\r\n      active: true,\r\n      created_by: prof.id,\r\n    });\r\n\r\n    console.log(`[homework_api] Created assignment ${data.id} with auto run_token: ${autoToken}`);\r\n    return jsonResponse(200, { success: true, assignment: data, run_token: autoToken }, origin);\r\n  } catch (err) {\r\n    console.error('create_assignment error:', err);\r\n    return jsonResponse(500, { success: false, error: `Failed to create assignment: ${err.message}` }, origin);\r\n  }\r\n}\r\n\r\nasync function handleCreateRun(request, supabase, params, origin) {\r\n  const userId = await getUserIdFromCookie(request, supabase);\r\n  if (!userId) {\r\n    return jsonResponse(401, { success: false, error: 'Not signed in' }, origin);\r\n  }\r\n\r\n  const prof = await getProfile(supabase, userId);\r\n  if (!prof || !['teacher', 'admin'].includes(String(prof.role || '').toLowerCase())) {\r\n    return jsonResponse(403, { success: false, error: 'Only teachers can create run tokens' }, origin);\r\n  }\r\n\r\n  const assignmentId = params.get('assignment_id') || params.get('id');\r\n  if (!assignmentId) {\r\n    return jsonResponse(400, { success: false, error: 'Missing assignment_id' }, origin);\r\n  }\r\n\r\n  try {\r\n    const assignment = await supabase.query('homework_assignments', {\r\n      select: 'id,list_meta',\r\n      filters: [{ column: 'id', op: 'eq', value: assignmentId }],\r\n      single: true,\r\n    });\r\n\r\n    const list_meta = assignment.list_meta || {};\r\n    const prev = Array.isArray(list_meta.run_tokens) ? list_meta.run_tokens : [];\r\n    const token = generateRunToken(assignmentId);\r\n    const updated = { ...list_meta, run_tokens: [...prev, { token, created_at: new Date().toISOString() }] };\r\n\r\n    await supabase.update('homework_assignments', [{ column: 'id', op: 'eq', value: assignmentId }], { list_meta: updated });\r\n\r\n    return jsonResponse(200, { success: true, assignment_id: assignmentId, run_token: token }, origin);\r\n  } catch (err) {\r\n    return jsonResponse(500, { success: false, error: `Failed to persist run token: ${err.message}` }, origin);\r\n  }\r\n}\r\n\r\nasync function handleListAssignments(request, supabase, params, origin) {\r\n  const mode = params.get('mode') || 'teacher';\r\n  \r\n  if (mode === 'student') {\r\n    const userId = await getUserIdFromCookie(request, supabase);\r\n    if (!userId) {\r\n      return jsonResponse(401, { success: false, error: 'Not signed in' }, origin);\r\n    }\r\n    \r\n    const prof = await getProfile(supabase, userId);\r\n    if (!prof || !prof.class) {\r\n      return jsonResponse(400, { success: false, error: 'No class set for this profile' }, origin);\r\n    }\r\n\r\n    try {\r\n      // For students, get active assignments for their class\r\n      const url = `${supabase.url}/rest/v1/homework_assignments?select=*,profiles!homework_assignments_created_by_fkey(name)&class=eq.${encodeURIComponent(prof.class)}&active=eq.true&start_at=lte.${new Date().toISOString()}&order=due_at.asc`;\r\n      \r\n      const resp = await fetch(url, {\r\n        headers: {\r\n          'apikey': supabase.serviceKey,\r\n          'Authorization': `Bearer ${supabase.serviceKey}`,\r\n        },\r\n      });\r\n      \r\n      const data = await resp.json();\r\n      const assignments = (data || []).map(a => ({\r\n        ...a,\r\n        teacher_name: a.profiles?.name || null,\r\n      }));\r\n\r\n      return jsonResponse(200, {\r\n        success: true,\r\n        class: prof.class,\r\n        student_name: prof.name || prof.korean_name || null,\r\n        assignments,\r\n      }, origin);\r\n    } catch (err) {\r\n      return jsonResponse(500, { success: false, error: `Failed to fetch student homework: ${err.message}` }, origin);\r\n    }\r\n  }\r\n\r\n  // Teacher mode - list all or by class\r\n  const className = params.get('class');\r\n  \r\n  try {\r\n    let url = `${supabase.url}/rest/v1/homework_assignments?select=*&order=created_at.desc`;\r\n    if (className) {\r\n      url += `&class=eq.${encodeURIComponent(className)}`;\r\n    }\r\n    \r\n    const resp = await fetch(url, {\r\n      headers: {\r\n        'apikey': supabase.serviceKey,\r\n        'Authorization': `Bearer ${supabase.serviceKey}`,\r\n      },\r\n    });\r\n    \r\n    const data = await resp.json();\r\n    return jsonResponse(200, { success: true, assignments: data || [] }, origin);\r\n  } catch (err) {\r\n    return jsonResponse(500, { success: false, error: `Failed to fetch assignments: ${err.message}` }, origin);\r\n  }\r\n}\r\n\r\nasync function handleEndAssignment(request, supabase, origin) {\r\n  const userId = await getUserIdFromCookie(request, supabase);\r\n  if (!userId) {\r\n    return jsonResponse(401, { success: false, error: 'Not signed in' }, origin);\r\n  }\r\n\r\n  const prof = await getProfile(supabase, userId);\r\n  if (!prof || !['teacher', 'admin'].includes(String(prof.role || '').toLowerCase())) {\r\n    return jsonResponse(403, { success: false, error: 'Only teachers can end assignments' }, origin);\r\n  }\r\n\r\n  let body;\r\n  try {\r\n    body = await request.json();\r\n  } catch {\r\n    return jsonResponse(400, { success: false, error: 'Bad JSON' }, origin);\r\n  }\r\n\r\n  const assignmentId = body.id || body.assignment_id;\r\n  if (!assignmentId) {\r\n    return jsonResponse(400, { success: false, error: 'Missing assignment id' }, origin);\r\n  }\r\n\r\n  try {\r\n    const data = await supabase.update(\r\n      'homework_assignments',\r\n      [{ column: 'id', op: 'eq', value: assignmentId }],\r\n      { active: false, ended_at: new Date().toISOString() }\r\n    );\r\n    return jsonResponse(200, { success: true, assignment: data }, origin);\r\n  } catch (err) {\r\n    return jsonResponse(500, { success: false, error: `Failed to end assignment: ${err.message}` }, origin);\r\n  }\r\n}\r\n\r\nasync function handleAssignmentProgress(request, supabase, params, origin) {\r\n  const assignmentId = params.get('assignment_id') || params.get('id');\r\n  const className = params.get('class');\r\n  const requestRunToken = params.get('run_token');\r\n\r\n  if (!assignmentId) {\r\n    return jsonResponse(400, { success: false, error: 'Missing assignment_id' }, origin);\r\n  }\r\n\r\n  try {\r\n    // Fetch assignment\r\n    let assignment = await supabase.query('homework_assignments', {\r\n      select: '*',\r\n      filters: [{ column: 'id', op: 'eq', value: assignmentId }],\r\n      single: true,\r\n    });\r\n\r\n    if (!assignment) {\r\n      return jsonResponse(404, { success: false, error: 'Assignment not found' }, origin);\r\n    }\r\n\r\n    // Auto-create run token if assignment has none\r\n    let assignmentRunTokens = Array.isArray(assignment.list_meta?.run_tokens)\r\n      ? assignment.list_meta.run_tokens.map(r => r?.token).filter(Boolean)\r\n      : [];\r\n\r\n    if (assignmentRunTokens.length === 0) {\r\n      const autoToken = `run_backfill_${assignmentId}_${Date.now().toString(36)}_${Math.random().toString(36).slice(2, 8)}`;\r\n      const updatedMeta = {\r\n        ...(assignment.list_meta || {}),\r\n        run_tokens: [{ token: autoToken, created_at: new Date().toISOString(), auto: true, backfilled: true }],\r\n      };\r\n      \r\n      await supabase.update(\r\n        'homework_assignments',\r\n        [{ column: 'id', op: 'eq', value: assignmentId }],\r\n        { list_meta: updatedMeta }\r\n      );\r\n      \r\n      assignment.list_meta = updatedMeta;\r\n      assignmentRunTokens = [autoToken];\r\n      console.log(`[assignmentProgress] Backfilled run_token for assignment ${assignmentId}: ${autoToken}`);\r\n    }\r\n\r\n    const targetClass = className || assignment.class;\r\n    const category = determineCategory(assignment);\r\n\r\n    // Load students in class\r\n    const studentsUrl = `${supabase.url}/rest/v1/profiles?select=id,name,korean_name&class=eq.${encodeURIComponent(targetClass)}`;\r\n    const studentsResp = await fetch(studentsUrl, {\r\n      headers: {\r\n        'apikey': supabase.serviceKey,\r\n        'Authorization': `Bearer ${supabase.serviceKey}`,\r\n      },\r\n    });\r\n    const students = await studentsResp.json();\r\n\r\n    if (!students || !students.length) {\r\n      return jsonResponse(200, { \r\n        success: true, \r\n        assignment_id: assignment.id, \r\n        class: targetClass, \r\n        total_modes: getExpectedModes(category, assignment.list_key, new Set()), \r\n        category, \r\n        progress: [] \r\n      }, origin);\r\n    }\r\n\r\n    // Build list matching patterns (same logic as Netlify function)\r\n    const listKeyLast = assignment.list_key.split('/').pop();\r\n    const coreName = listKeyLast.replace(/\\.json$/, '');\r\n    const studentIds = students.map(s => s.id);\r\n\r\n    // Helper to fetch sessions with a given filter\r\n    async function fetchSessions(orFilter) {\r\n      // PostgREST requires proper encoding for `or` and `in` filters\r\n      const url = new URL(`${supabase.url}/rest/v1/progress_sessions`);\r\n      url.searchParams.set('select', 'user_id,list_name,mode,summary,list_size');\r\n      url.searchParams.set('user_id', `in.(${studentIds.join(',')})`);\r\n      url.searchParams.set('ended_at', 'not.is.null');\r\n      url.searchParams.set('or', orFilter);\r\n      \r\n      const resp = await fetch(url.toString(), {\r\n        headers: {\r\n          'apikey': supabase.serviceKey,\r\n          'Authorization': `Bearer ${supabase.serviceKey}`,\r\n        },\r\n      });\r\n      \r\n      if (!resp.ok) {\r\n        console.error(`[fetchSessions] Error ${resp.status}: ${await resp.text()}`);\r\n        return [];\r\n      }\r\n      return resp.json();\r\n    }\r\n\r\n    let sessions = [];\r\n\r\n    // 1) Primary attempt: tight matching by filename/path variants (same as Netlify)\r\n    const eq1 = listKeyLast;\r\n    const like1 = `%/${listKeyLast}`;\r\n    const like2 = `%/${listKeyLast}.json`;\r\n    const fuzzy1 = `%${coreName}%`;\r\n    const fuzzy2 = assignment.list_title \r\n      ? `%${assignment.list_title.toLowerCase().replace(/\\s+/g, '_')}%` \r\n      : null;\r\n\r\n    let orFilters = [\r\n      `list_name.eq.${eq1}`,\r\n      `list_name.ilike.${like1}`,\r\n      `list_name.ilike.${like2}`,\r\n      `list_name.ilike.${fuzzy1}`,\r\n    ];\r\n    if (fuzzy2) orFilters.push(`list_name.ilike.${fuzzy2}`);\r\n\r\n    // Add normalized token patterns (same as Netlify)\r\n    const normalizedFilename = normalizeListIdentifier(coreName);\r\n    const normalizedListKey = normalizeListIdentifier(assignment.list_key);\r\n    const normalizedTitle = normalizeListIdentifier(`${assignment.title || ''} ${assignment.list_title || ''}`);\r\n    const normalizedTokens = Array.from(new Set([normalizedFilename, normalizedListKey, normalizedTitle].filter(Boolean)))\r\n      .filter(token => token.length >= 3);\r\n    normalizedTokens.forEach(token => {\r\n      const safeToken = token.replace(/\\s+/g, '%');\r\n      orFilters.push(`list_name.ilike.%${safeToken}%`);\r\n    });\r\n\r\n    const primaryOrFilter = `(${orFilters.join(',')})`;\r\n    sessions = await fetchSessions(primaryOrFilter);\r\n    console.log(`[assignmentProgress] Primary query found ${sessions.length} sessions`);\r\n    if (sessions.length) {\r\n      console.log(`[assignmentProgress] Sample list_names:`, sessions.slice(0, 5).map(s => s.list_name));\r\n    }\r\n\r\n    // 2) Fallback: broad ilike on full list_key\r\n    if (sessions.length === 0 && assignment.list_key) {\r\n      const broadLike = `%${assignment.list_key}%`;\r\n      const broadFilter = `(list_name.ilike.${broadLike})`;\r\n      sessions = await fetchSessions(broadFilter);\r\n      console.log(`[assignmentProgress] Broad list_key fallback found ${sessions.length} sessions`);\r\n    }\r\n\r\n    // 3) Fallback: normalized coreName with wildcards\r\n    if (sessions.length === 0 && coreName) {\r\n      const normalized = coreName.replace(/[^a-z0-9]+/gi, '%');\r\n      const normFilter = `(list_name.ilike.%${normalized}%)`;\r\n      sessions = await fetchSessions(normFilter);\r\n      console.log(`[assignmentProgress] Normalized coreName fallback found ${sessions.length} sessions`);\r\n    }\r\n\r\n    // 4) Last resort: match by assignment title\r\n    if (sessions.length === 0 && assignment.title) {\r\n      const titleCore = assignment.title.toLowerCase().replace(/[^a-z0-9]+/g, '_').replace(/^_|_$/g, '');\r\n      if (titleCore) {\r\n        const titleFilter = `(list_name.ilike.%${titleCore}%)`;\r\n        sessions = await fetchSessions(titleFilter);\r\n        console.log(`[assignmentProgress] Title fallback found ${sessions.length} sessions`);\r\n      }\r\n    }\r\n\r\n    // Debug: log unique modes found\r\n    if (sessions.length) {\r\n      const uniqueModes = [...new Set(sessions.map(s => s.mode))];\r\n      console.log(`[assignmentProgress] Unique modes found: ${uniqueModes.join(', ')}`);\r\n    }\r\n\r\n    // Filter by run token if provided\r\n    const runTokens = [requestRunToken, ...assignmentRunTokens].filter(Boolean);\r\n    if (runTokens.length && sessions.length) {\r\n      const withToken = sessions.filter(s => {\r\n        try {\r\n          const sum = typeof s.summary === 'string' ? JSON.parse(s.summary) : s.summary;\r\n          const tok = sum?.assignment_run;\r\n          return tok && runTokens.includes(tok);\r\n        } catch {\r\n          return false;\r\n        }\r\n      });\r\n      \r\n      if (withToken.length) {\r\n        sessions = withToken;\r\n        console.log(`[assignmentProgress] Using ${withToken.length} run-linked sessions`);\r\n      }\r\n    }\r\n\r\n    // Parse summary helper\r\n    function parseSummary(summary) {\r\n      if (!summary) return null;\r\n      if (typeof summary === 'string') {\r\n        try { return JSON.parse(summary); } catch { return null; }\r\n      }\r\n      return summary;\r\n    }\r\n\r\n    // Derive stars from accuracy\r\n    function deriveStars(summary) {\r\n      const s = summary || {};\r\n      let acc = null;\r\n      \r\n      if (typeof s.accuracy === 'number') acc = s.accuracy;\r\n      else if (typeof s.score === 'number' && typeof s.total === 'number' && s.total > 0) acc = s.score / s.total;\r\n      else if (typeof s.score === 'number' && typeof s.max === 'number' && s.max > 0) acc = s.score / s.max;\r\n      \r\n      if (acc != null) {\r\n        if (acc >= 1) return 5;\r\n        if (acc >= 0.95) return 4;\r\n        if (acc >= 0.90) return 3;\r\n        if (acc >= 0.80) return 2;\r\n        if (acc >= 0.60) return 1;\r\n        return 0;\r\n      }\r\n      \r\n      if (typeof s.stars === 'number') return s.stars;\r\n      return 0;\r\n    }\r\n\r\n    // Build student progress map\r\n    const byStudent = new Map();\r\n    students.forEach(st => byStudent.set(st.id, {\r\n      user_id: st.id,\r\n      name: st.name,\r\n      korean_name: st.korean_name,\r\n      modes: {},\r\n      _score: 0,\r\n      _total: 0,\r\n    }));\r\n\r\n    // Process sessions - IMPROVED mode normalization\r\n    const encounteredModes = new Set();\r\n    \r\n    sessions.forEach(sess => {\r\n      const row = byStudent.get(sess.user_id);\r\n      if (!row) return;\r\n\r\n      const summary = parseSummary(sess.summary);\r\n      const stars = deriveStars(summary);\r\n      \r\n      // IMPORTANT: Normalize mode name to handle variations\r\n      const rawMode = sess.mode || 'unknown';\r\n      const modeKey = normalizeModeName(rawMode);\r\n      encounteredModes.add(modeKey);\r\n\r\n      // Track overall accuracy components\r\n      if (summary && typeof summary.score === 'number' && typeof summary.total === 'number' && summary.total > 0) {\r\n        row._score += summary.score;\r\n        row._total += summary.total;\r\n      } else if (summary && typeof summary.correct === 'number' && typeof summary.total === 'number' && summary.total > 0) {\r\n        row._score += summary.correct;\r\n        row._total += summary.total;\r\n      }\r\n\r\n      const prev = row.modes[modeKey];\r\n      const acc = summary && typeof summary.accuracy === 'number' \r\n        ? Math.round(summary.accuracy * 100) \r\n        : (summary && typeof summary.score === 'number' && typeof summary.total === 'number' && summary.total > 0 \r\n           ? Math.round((summary.score / summary.total) * 100) \r\n           : 0);\r\n\r\n      if (prev) {\r\n        if (stars > prev.stars) prev.stars = stars;\r\n        if (acc > prev.accuracy) prev.accuracy = acc;\r\n        prev.sessions += 1;\r\n      } else {\r\n        row.modes[modeKey] = { stars, accuracy: acc, sessions: 1 };\r\n      }\r\n    });\r\n\r\n    // Get expected total modes for this category\r\n    const totalModes = assignment.list_meta?.modes_total || \r\n                       assignment.list_meta?.total_modes || \r\n                       getExpectedModes(category, assignment.list_key, encounteredModes);\r\n\r\n    console.log(`[assignmentProgress] Category: ${category}, Total modes: ${totalModes}, Encountered: ${[...encounteredModes].join(', ')}`);\r\n\r\n    // Build final progress array\r\n    const progress = Array.from(byStudent.values()).map(r => {\r\n      const rawModesArr = Object.entries(r.modes).map(([mode, v]) => ({\r\n        mode,\r\n        bestStars: v.stars,\r\n        bestAccuracy: v.accuracy,\r\n        sessions: v.sessions,\r\n      }));\r\n\r\n      const starsEarned = rawModesArr.reduce((sum, m) => sum + (m.bestStars || 0), 0);\r\n      const bestAccuracy = rawModesArr.reduce((best, m) => Math.max(best, m.bestAccuracy || 0), 0);\r\n      const overallAccuracy = r._total > 0 ? Math.round((r._score / r._total) * 100) : 0;\r\n\r\n      // Count modes where student achieved at least 1 star (or lesson modes)\r\n      const countedModesArr = rawModesArr.filter(m => \r\n        (m.bestStars >= 1) || /grammar_lesson|lesson/i.test(m.mode)\r\n      );\r\n      const distinctModesAttempted = countedModesArr.length;\r\n      const completionPercent = totalModes > 0 ? Math.round((distinctModesAttempted / totalModes) * 100) : 0;\r\n\r\n      return {\r\n        user_id: r.user_id,\r\n        name: r.name,\r\n        korean_name: r.korean_name,\r\n        stars: starsEarned,\r\n        accuracy_best: bestAccuracy,\r\n        accuracy_overall: overallAccuracy,\r\n        completion: completionPercent,\r\n        modes_attempted: distinctModesAttempted,\r\n        modes_total: totalModes,\r\n        modes: rawModesArr,\r\n        status: assignment.active \r\n          ? (completionPercent >= 100 || starsEarned >= (assignment.goal_value || 5) ? 'Completed' : 'In Progress') \r\n          : 'Ended',\r\n        category,\r\n      };\r\n    });\r\n\r\n    return jsonResponse(200, {\r\n      success: true,\r\n      assignment_id: assignment.id,\r\n      class: targetClass,\r\n      total_modes: totalModes,\r\n      category,\r\n      progress,\r\n      debug: {\r\n        encountered_modes: [...encounteredModes],\r\n        sessions_count: sessions.length,\r\n      },\r\n    }, origin);\r\n\r\n  } catch (err) {\r\n    console.error('[assignmentProgress] Error:', err);\r\n    return jsonResponse(500, { success: false, error: err.message }, origin);\r\n  }\r\n}\r\n\r\nasync function handleGetRunToken(request, supabase, params, origin) {\r\n  const userId = await getUserIdFromCookie(request, supabase);\r\n  if (!userId) {\r\n    return jsonResponse(401, { success: false, error: 'Not signed in' }, origin);\r\n  }\r\n\r\n  const prof = await getProfile(supabase, userId);\r\n  if (!prof) {\r\n    return jsonResponse(401, { success: false, error: 'Profile not found' }, origin);\r\n  }\r\n\r\n  const assignmentId = params.get('assignment_id') || params.get('id');\r\n  const listKey = params.get('list_key') || params.get('listName') || params.get('list_name');\r\n\r\n  if (!assignmentId && !listKey) {\r\n    return jsonResponse(400, { success: false, error: 'Missing assignment_id or list_key' }, origin);\r\n  }\r\n\r\n  try {\r\n    let assignment;\r\n    \r\n    if (assignmentId) {\r\n      assignment = await supabase.query('homework_assignments', {\r\n        select: '*',\r\n        filters: [{ column: 'id', op: 'eq', value: assignmentId }],\r\n        single: true,\r\n      });\r\n    } else {\r\n      const url = `${supabase.url}/rest/v1/homework_assignments?select=*&class=eq.${encodeURIComponent(prof.class)}&active=eq.true&list_key=ilike.%${encodeURIComponent(listKey)}%&order=created_at.desc&limit=1`;\r\n      const resp = await fetch(url, {\r\n        headers: {\r\n          'apikey': supabase.serviceKey,\r\n          'Authorization': `Bearer ${supabase.serviceKey}`,\r\n        },\r\n      });\r\n      const data = await resp.json();\r\n      assignment = data?.[0];\r\n    }\r\n\r\n    if (!assignment || String(assignment.class) !== String(prof.class)) {\r\n      return jsonResponse(403, { success: false, error: 'Not assigned to this class' }, origin);\r\n    }\r\n\r\n    const tokens = Array.isArray(assignment.list_meta?.run_tokens)\r\n      ? assignment.list_meta.run_tokens.map(r => r?.token).filter(Boolean)\r\n      : [];\r\n\r\n    return jsonResponse(200, { success: true, assignment_id: assignment.id, tokens }, origin);\r\n  } catch (err) {\r\n    return jsonResponse(500, { success: false, error: err.message }, origin);\r\n  }\r\n}\r\n\r\nasync function handleLinkSessions(request, supabase, params, origin) {\r\n  const userId = await getUserIdFromCookie(request, supabase);\r\n  if (!userId) {\r\n    return jsonResponse(401, { success: false, error: 'Not signed in' }, origin);\r\n  }\r\n\r\n  const prof = await getProfile(supabase, userId);\r\n  if (!prof || !['teacher', 'admin'].includes(String(prof.role || '').toLowerCase())) {\r\n    return jsonResponse(403, { success: false, error: 'Only teachers can link sessions' }, origin);\r\n  }\r\n\r\n  const assignmentId = params.get('assignment_id') || params.get('id');\r\n  if (!assignmentId) {\r\n    return jsonResponse(400, { success: false, error: 'Missing assignment_id' }, origin);\r\n  }\r\n\r\n  try {\r\n    const assignment = await supabase.query('homework_assignments', {\r\n      select: '*',\r\n      filters: [{ column: 'id', op: 'eq', value: assignmentId }],\r\n      single: true,\r\n    });\r\n\r\n    if (!assignment) {\r\n      return jsonResponse(404, { success: false, error: 'Assignment not found' }, origin);\r\n    }\r\n\r\n    // Get or create run token\r\n    let runToken;\r\n    const existingTokens = Array.isArray(assignment.list_meta?.run_tokens)\r\n      ? assignment.list_meta.run_tokens.map(r => r?.token).filter(Boolean)\r\n      : [];\r\n\r\n    if (existingTokens.length > 0) {\r\n      runToken = existingTokens[0];\r\n    } else {\r\n      runToken = `run_link_${assignmentId}_${Date.now().toString(36)}_${Math.random().toString(36).slice(2, 8)}`;\r\n      const updatedMeta = {\r\n        ...(assignment.list_meta || {}),\r\n        run_tokens: [{ token: runToken, created_at: new Date().toISOString(), auto: true }],\r\n      };\r\n      await supabase.update(\r\n        'homework_assignments',\r\n        [{ column: 'id', op: 'eq', value: assignmentId }],\r\n        { list_meta: updatedMeta }\r\n      );\r\n    }\r\n\r\n    // Get students in class\r\n    const studentsUrl = `${supabase.url}/rest/v1/profiles?select=id&class=eq.${encodeURIComponent(assignment.class)}`;\r\n    const studentsResp = await fetch(studentsUrl, {\r\n      headers: {\r\n        'apikey': supabase.serviceKey,\r\n        'Authorization': `Bearer ${supabase.serviceKey}`,\r\n      },\r\n    });\r\n    const students = await studentsResp.json();\r\n\r\n    if (!students || !students.length) {\r\n      return jsonResponse(400, { success: false, error: 'No students found in class' }, origin);\r\n    }\r\n\r\n    const studentIds = students.map(s => s.id);\r\n    const listKeyLast = assignment.list_key.split('/').pop();\r\n    const coreName = listKeyLast.replace(/\\.json$/, '');\r\n\r\n    // Fetch matching sessions\r\n    const orConditions = [\r\n      `list_name.eq.${listKeyLast}`,\r\n      `list_name.ilike.%/${listKeyLast}`,\r\n      `list_name.ilike.%${coreName}%`,\r\n    ];\r\n\r\n    const sessionsUrl = `${supabase.url}/rest/v1/progress_sessions?select=id,session_id,user_id,list_name,mode,summary&user_id=in.(${studentIds.join(',')})&ended_at=not.is.null&or=(${orConditions.join(',')})`;\r\n    const sessionsResp = await fetch(sessionsUrl, {\r\n      headers: {\r\n        'apikey': supabase.serviceKey,\r\n        'Authorization': `Bearer ${supabase.serviceKey}`,\r\n      },\r\n    });\r\n    const sessions = await sessionsResp.json();\r\n\r\n    if (!sessions || !sessions.length) {\r\n      return jsonResponse(200, { success: true, message: 'No matching sessions found', linked: 0 }, origin);\r\n    }\r\n\r\n    // Filter sessions without assignment_run\r\n    const sessionsToLink = sessions.filter(s => {\r\n      try {\r\n        const sum = typeof s.summary === 'string' ? JSON.parse(s.summary) : s.summary;\r\n        return !sum || !sum.assignment_run;\r\n      } catch {\r\n        return true;\r\n      }\r\n    });\r\n\r\n    if (!sessionsToLink.length) {\r\n      return jsonResponse(200, {\r\n        success: true,\r\n        message: 'All matching sessions already linked',\r\n        linked: 0,\r\n        total_found: sessions.length,\r\n      }, origin);\r\n    }\r\n\r\n    // Link sessions\r\n    let linkedCount = 0;\r\n    const errors = [];\r\n\r\n    for (const sess of sessionsToLink) {\r\n      try {\r\n        let existingSummary = {};\r\n        try {\r\n          existingSummary = typeof sess.summary === 'string' ? JSON.parse(sess.summary) : (sess.summary || {});\r\n        } catch {\r\n          existingSummary = {};\r\n        }\r\n\r\n        const updatedSummary = {\r\n          ...existingSummary,\r\n          assignment_run: runToken,\r\n          linked_at: new Date().toISOString(),\r\n          linked_by: 'teacher_action',\r\n        };\r\n\r\n        await supabase.update(\r\n          'progress_sessions',\r\n          [{ column: 'id', op: 'eq', value: sess.id }],\r\n          { summary: updatedSummary }\r\n        );\r\n        linkedCount++;\r\n      } catch (e) {\r\n        errors.push({ session_id: sess.session_id, error: e.message });\r\n      }\r\n    }\r\n\r\n    console.log(`[link_sessions] Linked ${linkedCount}/${sessionsToLink.length} sessions to assignment ${assignmentId}`);\r\n\r\n    return jsonResponse(200, {\r\n      success: true,\r\n      message: `Linked ${linkedCount} sessions to assignment`,\r\n      linked: linkedCount,\r\n      total_found: sessions.length,\r\n      already_linked: sessions.length - sessionsToLink.length,\r\n      errors: errors.length > 0 ? errors : undefined,\r\n      run_token: runToken,\r\n    }, origin);\r\n\r\n  } catch (err) {\r\n    console.error('[link_sessions] Error:', err);\r\n    return jsonResponse(500, { success: false, error: err.message }, origin);\r\n  }\r\n}\r\n\r\n// ============================================================\r\n// MAIN HANDLER\r\n// ============================================================\r\n\r\nexport default {\r\n  async fetch(request, env, ctx) {\r\n    const origin = request.headers.get('Origin') || '';\r\n    const corsHeaders = getCorsHeaders(origin);\r\n\r\n    // Handle CORS preflight\r\n    if (request.method === 'OPTIONS') {\r\n      return new Response(null, { status: 204, headers: corsHeaders });\r\n    }\r\n\r\n    // Check for required env vars\r\n    const SUPABASE_URL = env.SUPABASE_URL;\r\n    const SUPABASE_SERVICE_KEY = env.SUPABASE_SERVICE_KEY || env.SUPABASE_SERVICE_ROLE_KEY;\r\n\r\n    if (!SUPABASE_URL || !SUPABASE_SERVICE_KEY) {\r\n      return jsonResponse(500, { \r\n        success: false, \r\n        error: 'Missing SUPABASE_URL or SUPABASE_SERVICE_KEY environment variables' \r\n      }, origin);\r\n    }\r\n\r\n    const supabase = new SupabaseClient(SUPABASE_URL, SUPABASE_SERVICE_KEY);\r\n    const url = new URL(request.url);\r\n    const params = url.searchParams;\r\n    const action = params.get('action') || 'list_assignments';\r\n\r\n    try {\r\n      switch (action) {\r\n        case 'create_assignment':\r\n          return await handleCreateAssignment(request, supabase, origin);\r\n\r\n        case 'create_run':\r\n          return await handleCreateRun(request, supabase, params, origin);\r\n\r\n        case 'get_run_token':\r\n          return await handleGetRunToken(request, supabase, params, origin);\r\n\r\n        case 'list_assignments':\r\n          return await handleListAssignments(request, supabase, params, origin);\r\n\r\n        case 'end_assignment':\r\n          return await handleEndAssignment(request, supabase, origin);\r\n\r\n        case 'assignment_progress':\r\n          return await handleAssignmentProgress(request, supabase, params, origin);\r\n\r\n        case 'link_sessions':\r\n          return await handleLinkSessions(request, supabase, params, origin);\r\n\r\n        case 'delete_assignment':\r\n          // TODO: Implement delete if needed\r\n          return jsonResponse(501, { success: false, error: 'delete_assignment not yet implemented' }, origin);\r\n\r\n        default:\r\n          return jsonResponse(400, { success: false, error: `Unknown action: ${action}` }, origin);\r\n      }\r\n    } catch (err) {\r\n      console.error('[homework_api] Unhandled error:', err);\r\n      return jsonResponse(500, { success: false, error: err.message || 'Server error' }, origin);\r\n    }\r\n  },\r\n};\r\n"],
  "mappings": "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",
  "names": []
}
