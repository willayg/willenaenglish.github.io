<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin - Manage Teachers</title>
  <script>
    // Teachers auth requires same-origin cookies - redirect to Netlify if on custom domain
    (function() {
      const host = window.location.hostname;
      if (host === 'willenaenglish.com' || host === 'www.willenaenglish.com' || host === 'willenaenglish.github.io') {
        const currentPath = window.location.pathname + window.location.search;
        window.location.href = 'https://willenaenglish.netlify.app' + currentPath;
      }
    })();
  </script>
  <script src="/js/api-config.js"></script>
  <link rel="stylesheet" href="/Teachers/components/style.css">
  <style>
    body { font-family: 'Poppins', Arial, sans-serif; background: #f7f9fb; margin: 0; }
    .admin-container { max-width: 900px; margin: 40px auto; background: #fff; border-radius: 12px; box-shadow: 0 2px 16px rgba(0,0,0,0.08); padding: 32px; }
    h1 { text-align: center; color: #1976d2; margin-bottom: 24px; }
    .teacher-table { width: 100%; border-collapse: collapse; margin-top: 24px; }
    .teacher-table th, .teacher-table td { padding: 10px 12px; border-bottom: 1px solid #e0e0e0; text-align: left; }
    .teacher-table th { background: #f0f6ff; color: #1976d2; font-weight: 600; }
    .teacher-table tr:last-child td { border-bottom: none; }
    .toggle-btn { padding: 6px 16px; border-radius: 5px; border: none; font-size: 1em; cursor: pointer; }
    .toggle-btn.approved { background: #4caf50; color: #fff; }
    .toggle-btn.disapproved { background: #f44336; color: #fff; }
  </style>
</head>
<body>
  <style>
    .admin-top-bar { position:sticky; top:0; z-index:600; display:flex; align-items:center; gap:18px; padding:10px 18px; background:#0f172a; box-shadow:0 4px 18px -4px rgba(0,0,0,.35); }
    .admin-top-bar h2 { margin:0; font-size:1.05rem; font-weight:700; color:#67e2e6; letter-spacing:.5px; }
    .admin-burger { position:relative; }
    .admin-burger button { background:none; border:2px solid #67e2e6; color:#67e2e6; font-size:22px; padding:6px 14px; border-radius:12px; font-weight:700; cursor:pointer; letter-spacing:.5px; }
    .admin-burger button:hover { background:#67e2e6; color:#0f172a; }
    .admin-menu { position:absolute; top:100%; left:0; margin-top:10px; background:#fff; border:1px solid #e2e8f0; border-radius:16px; min-width:240px; box-shadow:0 10px 34px -8px rgba(0,0,0,.35); padding:6px 0; display:none; }
    .admin-menu.open { display:block; animation:fadeIn .18s ease; }
    .admin-menu a { display:flex; align-items:center; gap:10px; padding:10px 16px; font-weight:600; font-size:.85rem; color:#0f172a; text-decoration:none; letter-spacing:.3px; }
    .admin-menu a:hover { background:#f1f7f9; }
    @keyframes fadeIn { from { opacity:0; transform:translateY(-4px);} to { opacity:1; transform:translateY(0);} }
  </style>
  <div class="admin-top-bar">
    <div class="admin-burger">
      <button class="admin-burger-btn" aria-haspopup="true" aria-expanded="false">‚ò∞</button>
      <div class="admin-menu" role="menu">
        <a href="/Teachers/components/admin-dashboard.html" role="menuitem">üìä Admin Dashboard</a>
        <a href="/Teachers/components/feedback-admin.html" role="menuitem">üí¨ Feedback Admin</a>
        <a href="/Teachers/components/admin_teachers.html" role="menuitem" style="font-weight:800;color:#1976d2;">üë©‚Äçüè´ Manage Teachers</a>
        <a href="/Teachers/tools/planner/planner.html" role="menuitem">üìù Planner</a>
        <a href="#" data-action="bugs" role="menuitem">üêû Bugs</a>
        <a href="/Teachers/index.html" role="menuitem">üè† Teacher Dashboard</a>
        <a href="/Teachers/login.html" data-action="logout" role="menuitem">üö™ Logout</a>
      </div>
    </div>
    <h2 class="admin-header-title">Manage Teachers</h2>
  </div>
  <script>
    (function(){
      const bar = document.querySelector('.admin-top-bar');
      const btn = bar.querySelector('.admin-burger-btn');
      const menu = bar.querySelector('.admin-menu');
      btn.addEventListener('click', ()=>{ const open = menu.classList.toggle('open'); btn.setAttribute('aria-expanded', open); });
      document.addEventListener('click', (e)=>{ if(!menu.contains(e.target) && !btn.contains(e.target) && menu.classList.contains('open')){ menu.classList.remove('open'); btn.setAttribute('aria-expanded','false'); } }, true);
      menu.addEventListener('click', (e)=>{ const a = e.target.closest('a'); if(!a) return; if(a.dataset.action==='bugs'){ e.preventDefault(); if(window.showFeedbackModal) window.showFeedbackModal(); else alert('Feedback modal not available.'); menu.classList.remove('open'); } else if(a.dataset.action==='logout'){ e.preventDefault(); WillenaAPI.fetch('/.netlify/functions/supabase_auth?action=logout',{method:'POST'}).finally(()=> location.href='/Teachers/login.html'); } });
    })();
  </script>
  <div class="admin-container">
    <div style="width:100%; display:flex; justify-content:flex-end; margin-bottom:16px;">
      <a href="/Teachers/components/admin-dashboard.html" class="dashboard-btn" style="background:#1976d2; color:#fff; font-weight:600; border:none; border-radius:6px; padding:10px 22px; font-size:1rem; text-decoration:none; box-shadow:0 2px 8px rgba(30,41,59,0.10); transition:background 0.2s;">Back to Admin Dashboard</a>
    </div>
    <h1>Manage Teachers</h1>
    <table class="teacher-table" id="teacherTable">
      <thead>
        <tr>
          <th>Name</th>
          <th>Email</th>
          <th>Approved</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        <!-- Teacher rows will be inserted here -->
      </tbody>
    </table>
  </div>
  <script>
    async function fetchTeachers() {
      const res = await WillenaAPI.fetch('/.netlify/functions/supabase_proxy_fixed?action=get_teachers');
      const teachers = await res.json();
      const tbody = document.querySelector('#teacherTable tbody');
      tbody.innerHTML = '';
      teachers.forEach(teacher => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${teacher.name || ''}</td>
          <td>${teacher.email || ''}</td>
          <td>${teacher.approved ? 'Yes' : 'No'}</td>
          <td>
            <button class="toggle-btn ${teacher.approved ? 'approved' : 'disapproved'}" onclick="toggleApprove('${teacher.id}', ${teacher.approved})">
              ${teacher.approved ? 'Disapprove' : 'Approve'}
            </button>
          </td>
        `;
        tbody.appendChild(tr);
      });
    }

    async function toggleApprove(id, currentStatus) {
      const newStatus = !currentStatus;
      await WillenaAPI.fetch('/.netlify/functions/supabase_proxy_fixed?action=update_teacher_approval', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ id, approved: newStatus })
      });
      fetchTeachers();
    }

    fetchTeachers();
  </script>
</body>
</html>
