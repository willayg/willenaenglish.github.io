<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Student Tracker • English Arcade</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="style.css" />
  <link rel="stylesheet" href="homework-modal.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <style>
    /* Global 10% UI scale down for tracker: reduces fonts and container sizes */
     :root { --tracker-scale: 0.95; --tracker-vertical-offset: 140px; --tracker-font-bump: 1.02; }
     /* Prefer reducing root font-size so rem/em-based typography shrinks.
       Apply a small font bump so typography is 2% larger while layout scale stays the same. */
     html { font-size: calc(100% * var(--tracker-scale) * var(--tracker-font-bump)); }
    /* Also scale whole layout to catch fixed-pixel elements and containers */
    body {
      transform: scale(var(--tracker-scale));
      transform-origin: 0 0;
      /* Compensate for the scale so layout fits viewport width */
      width: calc(100% / var(--tracker-scale));
      /* Ensure body occupies viewport height so calc() heights behave */
      min-height: 100vh;
    }
    /* Allow more vertical space overall by reducing the top/bottom offset used in layout heights.
       This makes containers taller so more content fits vertically after the global scale down. */
    main, .layout { min-height: calc(100vh - var(--tracker-vertical-offset)); }
    /* Override the homework layout height specifically (originally used calc(100vh - 200px)) */
    #homework-content .layout { height: calc(100vh - var(--tracker-vertical-offset)); }
    /* Stretch scroll-wrap areas to take available height where appropriate */
    .scroll-wrap { max-height: none; min-height: 0; }
    /* Ensure modals don't get clipped after scaling by increasing their effective max-height */
    .homework-modal, .homework-preview-modal { max-height: calc(100vh - 80px); overflow: auto; }
  </style>
</head>
<body>
  <!-- Load api-config.js first -->
  <script src="/js/api-config.js"></script>
  
  <!-- Load burger-menu.js to make insertBurgerMenu available globally -->
  <script type="module">
    import { insertBurgerMenu } from '/Teachers/components/burger-menu.js';
    // Expose globally for main.js to use
    window.insertBurgerMenu = insertBurgerMenu;
  </script>
  
  <header>
    <img src="/Assets/Images/Logo.png" alt="Logo" />
    <h1>Student Tracker • English Arcade</h1>
    <div id="burger-menu-mount"></div>
  </header>
  <div class="nav-tabs">
    <a href="#" class="nav-tab active" data-tab="student-tracker">Student Tracker</a>
    <a href="#" class="nav-tab" data-tab="class-tracker">Class Tracker</a>
    <a href="#" class="nav-tab" data-tab="homework">Homework</a>
  </div>
  <main>
    <div class="tab-content active" id="student-tracker-content">
      <div class="layout">
      <div class="card">
        <div class="filters">
          <div class="group">
            <label for="classSel" class="mut">Class</label>
            <select id="classSel"><option value="">Loading…</option></select>
          </div>
          <div class="group">
            <label for="timeSel" class="mut">Timeframe</label>
            <select id="timeSel">
              <option value="month">This month</option>
              <option value="all">All time</option>
            </select>
          </div>
          <div class="group" style="margin-left:auto;">
            <input id="searchBox" type="search" placeholder="Search name…" />
            <button class="ghost" id="refreshBtn">Refresh</button>
          </div>
          <div id="statusMsg" class="status"></div>
        </div>
        <div class="grid">
          <!-- Leaderboard -->
          <div class="card" style="overflow:hidden;">
            <div class="section-title" id="leaderboardTitle">Leaderboard</div>
            <div class="scroll-wrap">
              <table id="lbTable">
                <thead>
                  <tr>
                    <th class="rank sortable" data-sort="rank">#</th>
                    <th class="sortable" data-sort="name">Name</th>
                    <th class="sortable" data-sort="korean_name">Korean Name</th>
                    <th class="num sortable" data-sort="stars">Stars</th>
                    <th class="num sortable" data-sort="points">Points</th>
                    <th class="num sortable" data-sort="super_score">Super Score</th>
                    <th class="num sortable" data-sort="accuracy">Accuracy</th>
                  </tr>
                </thead>
                <tbody id="lbBody">
                  <tr><td colspan="7" class="empty">Choose a class to load leaderboard…</td></tr>
                </tbody>
              </table>
            </div>
          </div>
          <!-- Student details -->
          <div class="card">
            <div class="section-title" id="studentTitle">Student details</div>
            <div class="tabs-header">
              <button class="tab-btn active" data-tab="overview">Overview</button>
              <button class="tab-btn" data-tab="games">Games</button>
              <button class="tab-btn" data-tab="tests">Tests</button>
            </div>
            <div class="student-panel" id="studentPanel">
              <div id="tab-overview" class="tab-content active">
                <div class="empty">Click a student name to view their stats.</div>
              </div>
              <div id="tab-games" class="tab-content">
                <div class="empty">No games played yet.</div>
              </div>
              <div id="tab-tests" class="tab-content">
                <div class="empty">Tests data coming soon.</div>
              </div>
            </div>
          </div>
        </div>
      </div>
      </div>
    </div>
    <div class="tab-content" id="class-tracker-content">
      <div class="layout">
        <div class="card">
          <div class="grid class-tracker-grid">
            <!-- Classes list -->
            <div class="card" style="overflow:hidden;">
              <div class="section-title">Classes</div>
              <div class="scroll-wrap">
                <div id="classList" style="display:flex; flex-direction:column;">
                  <div style="padding:16px; color:#6b7280;">Loading classes...</div>
                </div>
              </div>
            </div>
            <!-- Top 3 students -->
            <div class="card">
              <div class="section-title" id="classStatsTitle">Class Stats</div>
              <div id="classStatsContent" style="padding:16px; color:#6b7280;">
                <p>Select a class to view top students.</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="tab-content" id="homework-content">
      <style>
        #homework-content .layout { display: flex; flex-direction: row; height: calc(100vh - 200px); gap: 0; }
        #homework-content .card { flex: 0 0 auto; display: flex; flex-direction: column; }
        #homework-content .grid.class-tracker-grid { display: flex; flex-direction: row; gap: 0; height: 100%; }
  #homework-content .card:first-child { width: 180px; min-width: 160px; max-width: 220px; border-right: 1px solid #e2e8f0; height: 100%; display: flex; flex-direction: column; overflow-y: auto; }
        #homework-content #homeworkClassList { gap: 8px; }
        #homework-content .homework-class-btn { padding: 8px 12px; background: #fff; border: 1px solid #e2e8f0; border-radius: 8px; cursor: pointer; text-align: left; font-size: 0.9rem; transition: all 0.2s; }
        #homework-content .homework-class-btn:hover { background: #f3f4f6; }
        #homework-content .homework-class-btn.active { background: #19777e; color: #fff; border-color: #19777e; }
        #homework-content .class-item.homework-active span { font-weight: 600; }
        #homework-content .card:last-child { flex: 1; display: flex; flex-direction: column; min-width: 0; }
        #homework-content .homework-panel { display: flex; flex-direction: row; gap: 16px; padding: 16px; height: 100%; overflow: auto; }
        #homework-content .homework-students-block { flex: 1; display: flex; flex-direction: column; min-width: 0; }
        #homework-content .homework-assignment-block { width: 156px; min-width: 143px; max-width: 182px; display: flex; flex-direction: column; border-left: 1px solid #e2e8f0; padding-left: 16px; }
        #homework-content .homework-table { width: 100%; font-size: 0.85rem; }
        #homework-content .homework-table th, #homework-content .homework-table td { padding: 8px; }
        #homework-content .card.assignment-container { width: 208px; min-width: 143px; max-width: 312px; height: 100%; overflow-y: auto; overflow-x: hidden; border-right: 1px solid #e2e8f0; background: #f9fafb; }
        #homework-content #assignmentList { height: 100%; overflow-y: auto; padding-right: 6px; }
        #homework-content .card:first-child { max-width: 208px; }
          #homework-content .hw-assignment-card {
            border: 2px solid #22d3ee;
            box-shadow: 0 2px 8px rgba(34,211,238,0.08), 0 1px 3px rgba(0,0,0,.04);
            transition: box-shadow 0.18s, transform 0.18s, border-color 0.18s;
            cursor: pointer;
          }
          #homework-content .hw-assignment-card.selected {
            background: linear-gradient(180deg,#ecfeff,#f0fdfa);
            border-color: #06b6d4;
            box-shadow: 0 8px 24px rgba(6,182,212,0.12);
            transform: translateY(-2px) scale(1.02);
          }
          #homework-content .hw-assignment-card:hover {
            box-shadow: 0 4px 16px rgba(34,211,238,0.18), 0 2px 8px rgba(0,0,0,.08);
            border-color: #06b6d4;
            transform: translateY(-2px) scale(1.03);
          }
          #homework-content .hw-assignment-card:active {
            box-shadow: 0 2px 8px rgba(34,211,238,0.08), 0 1px 3px rgba(0,0,0,.04);
            border-color: #0891b2;
            transform: scale(0.98);
          }
      </style>
      <div class="layout">
        <div class="card">
          <div class="section-title">Classes</div>
          <div class="scroll-wrap">
            <div id="homeworkClassList" style="display:flex; flex-direction:column;">
              <div style="padding:16px; color:#6b7280;">Select a class to view homework.</div>
            </div>
          </div>
        </div>
        <!-- Homework: Assignments list (vertical, narrow cards) -->
  <div class="card assignment-container" style="display: flex; flex-direction: column;">
          <div class="section-title" style="font-size: 0.95rem; margin-bottom: 0; padding: 14px 22px;">Assignments</div>
          <div role="tablist" class="assignment-tabs">
            <button id="assignmentTabActive" role="tab" aria-controls="assignmentList" aria-selected="true" class="assignment-filter-tab assignment-filter-tab-active">Active</button>
            <button id="assignmentTabEnded" role="tab" aria-controls="assignmentList" aria-selected="false" class="assignment-filter-tab">Ended</button>
          </div>
          <div id="assignmentList" style="display: flex; flex-direction: column; gap: 10px; padding: 0 12px; flex: 1; overflow-y: auto;"></div>
        </div>
        <!-- Homework: per-student progress + assignment controls -->
        <div class="card" style="flex: 1; display: flex; flex-direction: column; min-width: 0;">
          <div class="section-title" id="homeworkPanelTitle" style="display: flex; align-items: center; justify-content: space-between; padding: 0 16px;">
            <span>Homework Tracker</span>
            <button type="button" class="ghost" id="hwAssignBtn">Assign Homework</button>
          </div>
          <div class="homework-panel" style="padding: 16px; flex: 1; overflow: auto;">
            <div class="homework-students-block" style="flex: 1; min-width: 0;">
              <div class="homework-students-header">
                <div class="homework-students-title">Students</div>
                <div class="homework-students-subtitle" id="homeworkStudentsSubtitle">No class selected.</div>
              </div>
              <div class="scroll-wrap homework-students-scroll" style="flex: 1; overflow: auto;">
                <table class="homework-table" id="homeworkStudentsTable">
                  <thead>
                    <tr>
                      <th>Name</th>
                      <th>Korean Name</th>
                      <th>Status</th>
                      <th class="num">Completion</th>
                      <th class="num">Accuracy</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td colspan="5" class="empty">Choose a class on the left to see homework progress.</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Homework Assignment Modal -->
  <div id="homeworkModalOverlay" class="homework-modal-overlay">
    <div class="homework-modal">
      <div class="homework-modal-header">
        <h2 class="homework-modal-title">Assign Homework • <span id="hwModalClassLabel"></span></h2>
        <button type="button" class="homework-modal-close" id="hwModalClose">&times;</button>
      </div>
      <div class="homework-modal-body">
        
        <div class="homework-modal-section homework-modal-search-section">
          <label class="homework-modal-label">Search for a Wordlist</label>
          <div class="homework-modal-filters" style="margin-bottom:10px; display:flex; gap:8px; flex-wrap:wrap;">
            <button type="button" class="homework-modal-filter-btn" data-filter="all">All</button>
            <button type="button" class="homework-modal-filter-btn" data-filter="vocab">Vocabulary</button>
            <button type="button" class="homework-modal-filter-btn" data-filter="grammar">Grammar</button>
            <button type="button" class="homework-modal-filter-btn" data-filter="phonics">Phonics</button>
            <!-- Level filters -->
            <div style="width:100%; height:0;"></div>
            <div style="display:flex; gap:6px; align-items:center; margin-top:6px;">
              <span style="font-size:0.85rem; color:#6b7280; margin-right:6px;">Level</span>
              <button type="button" class="homework-modal-filter-btn" data-filter="level:1">1</button>
              <button type="button" class="homework-modal-filter-btn" data-filter="level:2">2</button>
              <button type="button" class="homework-modal-filter-btn" data-filter="level:3">3</button>
              <button type="button" class="homework-modal-filter-btn" data-filter="level:4">4</button>
              <button type="button" class="homework-modal-filter-btn" data-filter="level:5">5</button>
              <button type="button" class="homework-modal-filter-btn" data-filter="level:6">6</button>
            </div>
          </div>
          <input 
            type="search" 
            id="hwModalSearch" 
            class="homework-modal-search-input" 
            placeholder="Search by title, tags, or filename..."
            autocomplete="off"
          />
          <div id="hwModalResults" class="homework-modal-results">
            <div class="homework-modal-empty-state">Start typing to search wordlists...</div>
          </div>
        </div>

        <div id="hwModalSelectedList" class="homework-modal-selected-list" style="display: none;">
          <div class="homework-modal-selected-title" id="hwModalSelectedTitle"></div>
          <div class="homework-modal-selected-meta" id="hwModalSelectedMeta"></div>
        </div>

        <div class="homework-modal-section">
          <label class="homework-modal-label" for="hwModalTitle">Assignment Title *</label>
          <input 
            type="text" 
            id="hwModalTitle" 
            class="homework-modal-input" 
            placeholder="e.g., Week 5 Vocabulary Practice"
            maxlength="100"
          />
        </div>

        <div class="homework-modal-section">
          <label class="homework-modal-label" for="hwModalDescription">Description (optional)</label>
          <textarea 
            id="hwModalDescription" 
            class="homework-modal-textarea" 
            placeholder="Add notes or instructions for students..."
            maxlength="500"
          ></textarea>
        </div>

        <div class="homework-modal-section">
          <label class="homework-modal-label" for="hwModalDueDate">Due Date *</label>
          <input 
            type="date" 
            id="hwModalDueDate" 
            class="homework-modal-input"
          />
          <div class="homework-modal-helper">Students will see this deadline in their dashboard</div>
        </div>

      </div>
      <div class="homework-modal-footer">
        <button type="button" class="homework-modal-btn homework-modal-btn-cancel" id="hwModalCancel">Cancel</button>
        <button type="button" class="homework-modal-btn homework-modal-btn-primary" id="hwModalAssign" disabled>Assign Homework</button>
      </div>
    </div>
  </div>

  <!-- Preview Modal -->
  <div id="homeworkPreviewOverlay" class="homework-preview-overlay">
    <div class="homework-preview-modal">
      <div class="homework-preview-header">
        <h3 class="homework-preview-title" id="hwPreviewTitle">Preview</h3>
        <button type="button" class="homework-preview-close" id="hwPreviewClose">&times;</button>
      </div>
      <div class="homework-preview-body">
        <ul id="hwPreviewList" class="homework-preview-list"></ul>
      </div>
    </div>
  </div>

  <script src="homework-modal.js"></script>
  <script src="main.js"></script>
  <!-- Homework Student Detail Modal -->
  <div id="hwStudentModal" style="display:none;position:fixed;inset:0;z-index:9999;background:rgba(0,0,0,.45);backdrop-filter:blur(2px);align-items:center;justify-content:center;padding:24px;">
    <div style="background:#fff;border-radius:18px;max-width:640px;width:100%;box-shadow:0 6px 32px rgba(0,0,0,.25);font-family:'Poppins',sans-serif;position:relative;padding:28px;">
      <button id="hwStudentClose" aria-label="Close" style="position:absolute;top:10px;right:12px;background:none;border:none;font-size:24px;cursor:pointer;color:#19777e;">×</button>
      <h2 id="hwStudentTitle" style="margin:0 0 10px;font-size:1.5rem;font-weight:700;color:#19777e;">Student Homework Details</h2>
      <div id="hwStudentMeta" style="font-size:.85rem;color:#555;margin-bottom:16px;">Loading...</div>
      <div id="hwStudentModes" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:14px;"></div>
      <div style="margin-top:20px;font-size:.75rem;color:#888;">Stars shown are best stars per mode. Completion = distinct modes attempted / total modes (6).</div>
    </div>
  </div>
</body>
</html>
