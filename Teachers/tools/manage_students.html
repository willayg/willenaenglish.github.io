<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Manage Students</title>
  <!-- Use the same font and style stack as Word Builder -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preload" href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
  <link rel="stylesheet" href="/Teachers/tools/wordtest/style.css" />
  <style>
    :root { --header-h: 70px; --actions-h: 44px; }
    /* Minimal pill styles for Approved column */
    .pill { padding:2px 8px; border-radius:999px; font-weight:700; font-size:12px; display:inline-block; }
    .pill.yes { background:#e8fff5; color:#185281; border:1px solid #b9edef; }
    .pill.no { background:#fff5f5; color:#a11; border:1px solid #f1c5c5; }
    /* Override header color to blue gradient */
    .header {
      background: linear-gradient(135deg, #2563eb 0%, #60a5fa 100%) !important;
      position: sticky !important;
      top: 0;
      z-index: 1000;
      box-shadow: 0 2px 6px rgba(0,0,0,0.08);
    }
    /* Make names column text darker */
    .worksheet-preview td:nth-child(2), .worksheet-preview th:nth-child(2) {
      color: #222;
      font-weight: 600;
    }
    /* Make all student list text darker */
    .worksheet-preview td, .worksheet-preview th {
      color: #222;
    }
    /* Student list scrolls within its container, sticky header */
    .list {
      height: 70vh; /* fixed internal scroll area */
      overflow-y: auto !important;
      overflow-x: hidden;
      scrollbar-width: thin;
      background: #fff;
      border-radius: 8px;
    }
    .worksheet-preview thead th {
      position: sticky;
      top: 0;
      background: #f8f9fa; /* ensure header row stays opaque */
      z-index: 2;
    }
    /* Menu bar override: light sky blue */
    .top-actions, .floating-toolbar { background: #e0f2fe !important; }
    .top-actions { position: sticky; top: var(--header-h); z-index: 999; box-shadow: 0 1px 3px rgba(0,0,0,0.06); }
    .floating-toolbar { position: sticky; top: calc(var(--header-h) + var(--actions-h)); z-index: 998; box-shadow: 0 1px 3px rgba(0,0,0,0.04); }
    /* Make main content full-width (remove sidebar layout) */
    .main-content { display:block !important; }
    .preview-area { max-width:none !important; min-width:auto !important; width:100% !important; }
    .word-list-container { max-width:none !important; }
    .list { height: 72vh; }
  </style>
</head>
<body>
  <div class="container">
    <div class="app-card">
      <!-- Header -->
      <div class="header" style="position:relative;">
        <div class="logo">
          <img src="../../Assets/Images/Logo.png" alt="Willena" class="logo-img">
        </div>
        <h1>Manage Students</h1>
        <div id="burger-menu-mount"></div>
      </div>

      <!-- Top Actions -->
      <div class="top-actions">
        <span id="openBulkModal" class="action-link">Add Full Class</span>
        <span id="openAddAllModal" class="action-link">Add All</span>
        <span id="openSingleAddModal" class="action-link">Add Student</span>
        <span id="openRenameClassModal" class="action-link">Move Class Up</span>
        <span id="langToggleBtn" class="action-link" style="margin-left:auto;">한국어 | English</span>
      </div>

      <!-- Floating Toolbar (filters/search) -->
      <div class="floating-toolbar">
        <input id="search" class="input-field" placeholder="Search by username or name" style="max-width:360px;" />
        <select id="classFilter" class="toolbar-select">
          <option value="">All Classes</option>
        </select>
        <label for="classFilter" style="font-size:12px; color:#4a5568; font-weight:500;">Class:</label>
        <button id="refreshBtn" class="layout-btn">Refresh</button>
        <div id="listMsg" style="margin-left:12px; color:#a11; font-size:13px;"></div>
      </div>

      <!-- Main Content -->
      <div class="main-content">
        <!-- Right: Student List -->
        <div class="preview-area" style="display:block; width:100%;height:78vh">
          <div class="word-list-container" style="width:100%;">
            <div class="word-list-header">Students</div>
            <div class="word-list" style="padding:0;">
              <div class="list" style="max-height:90vh; overflow:auto;">
                <div class="worksheet-preview">
                  <!-- Tool button names switch between English and Korean based on language mode (handled by JS) -->
                  <table style="table-layout:fixed; width:100%;">
                      <colgroup>
                        <col style="width:120px;"> <!-- Username -->
                        <col style="width:120px;"> <!-- Name -->
                        <col style="width:120px;"> <!-- Korean Name -->
                        <col style="width:110px;"> <!-- Class -->
                        <col style="width:80px;">  <!-- Grade -->
                        <col style="width:140px;"> <!-- School -->
                        <col style="width:120px;"> <!-- Phone -->
                        <col style="width:90px;">  <!-- Approved -->
                        <col style="width:auto;">  <!-- Tools -->
                      </colgroup>
                    <thead>
                      <tr>
                        <th>Username</th>
                        <th>Name</th>
                        <th>Korean Name</th>
                        <th>Class</th>
                        <th>Grade</th>
                        <th>School</th>
                        <th>Phone</th>
                        <th>Approved</th>
                        <th style="min-width:240px;">Tools</th>
                      </tr>
                    </thead>
                    <tbody id="rows"></tbody>
                  </table>
                </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Add Student Modal -->
  <div id="singleAddModalBg" style="display:none; position:fixed; left:0; top:0; width:100vw; height:100vh; background:rgba(30,41,59,0.18); z-index:9999; align-items:center; justify-content:center;">
    <div id="singleAddModal" style="background:#fff; border-radius:18px; box-shadow:0 8px 32px rgba(30,41,59,0.18); max-width:480px; width:96vw; margin:auto; padding:28px 18px 18px 18px; display:flex; flex-direction:column; gap:14px;">
      <h2 style="margin-bottom:8px; color:#19777e; font-size:1.18em; font-weight:800;">Add Student</h2>
      <div class="input-group">
        <label for="singleUsername">Username</label>
        <input id="singleUsername" class="input-field" placeholder="e.g. ellie2282" autocomplete="off" />
      </div>
      <div class="input-group">
        <label for="singlePassword">Password</label>
        <input id="singlePassword" class="input-field" type="password" placeholder="Set password" autocomplete="new-password" />
      </div>
      <div class="input-group">
        <label for="singleName">Name (optional)</label>
        <input id="singleName" class="input-field" placeholder="Ellie" />
      </div>
      <div class="input-group">
        <label for="singleKoreanName">Korean Name</label>
        <input id="singleKoreanName" class="input-field" placeholder="엘리" />
      </div>
      <div class="input-group">
        <label for="singleClass">Class (optional)</label>
        <input id="singleClass" class="input-field" placeholder="Brown" />
      </div>
      <div class="input-group" style="display:flex; align-items:center; gap:10px;">
        <label for="singleApproved" style="margin:0;">Approve</label>
        <input type="checkbox" id="singleApproved" checked />
      </div>
      <div style="display:flex; gap:10px; justify-content:flex-end;">
        <button id="singleAddCancel" class="clear-btn" type="button">Cancel</button>
        <button id="singleAddSubmit" class="extract-btn" type="button">Add Student</button>
      </div>
      <div id="singleAddMsg" style="color:#a11; font-size:0.98em; margin-top:6px;"></div>
    </div>
  </div>

  <!-- Add All Modal (paste entire multi-class roster) -->
  <div id="addAllModalBg" style="display:none; position:fixed; left:0; top:0; width:100vw; height:100vh; background:rgba(30,41,59,0.18); z-index:9999; align-items:center; justify-content:center;">
    <div id="addAllModal" style="background:#fff; border-radius:18px; box-shadow:0 8px 32px rgba(30,41,59,0.18); max-width:720px; width:96vw; margin:auto; padding:28px 18px 18px 18px; display:flex; flex-direction:column; gap:16px;">
      <h2 style="margin-bottom:8px; color:#19777e; font-size:1.18em; font-weight:800;">Add All Students</h2>
      <p style="margin:0; font-size:0.95em; color:#334155;">Paste the full list including class headers (e.g., "NewYork 기초2 ...") and the table rows. I'll parse School, Grade, Korean Name, English Name, and Phone, and assign the class from each header.</p>
      <label for="addAllText">Paste roster text</label>
      <textarea id="addAllText" rows="14" class="textarea-field" style="width:100%;" placeholder="Brown 왕기초1 (월~금) 2:00~3:10\nNo.\tSchool\tGrade\tName\t영어이름\tPhone\n1\t은계초\t1\t송서희\tLily\t010-3129-1248\n..."></textarea>
      <div style="display:flex; gap:10px; justify-content:space-between; align-items:center;">
        <div id="addAllStats" style="font-size:12px; color:#475569;"></div>
        <div style="display:flex; gap:10px;">
          <button id="addAllCancel" class="clear-btn" type="button">Cancel</button>
          <button id="addAllParse" class="layout-btn" type="button">Preview Count</button>
          <button id="addAllSubmit" class="extract-btn" type="button">Upload</button>
        </div>
      </div>
      <div id="addAllMsg" style="color:#a11; font-size:0.98em; margin-top:6px;"></div>
    </div>
  </div>

  <!-- Bulk Insert Modal -->
  <div id="bulkModalBg" style="display:none; position:fixed; left:0; top:0; width:100vw; height:100vh; background:rgba(30,41,59,0.18); z-index:9999; align-items:center; justify-content:center;">
    <div id="bulkModal" style="background:#fff; border-radius:18px; box-shadow:0 8px 32px rgba(30,41,59,0.18); max-width:420px; width:96vw; margin:auto; padding:28px 18px 18px 18px; display:flex; flex-direction:column; gap:16px;">
      <h2 style="margin-bottom:8px; color:#19777e; font-size:1.18em; font-weight:800;">Add Full Class</h2>
      <label for="bulkClass">Class</label>
      <input id="bulkClass" class="input-field" placeholder="e.g. 3-1" style="margin-bottom:10px;" />
      <label for="bulkList">Paste Korean name and English name (one per line, tab/comma separated)</label>
      <textarea id="bulkList" rows="8" class="textarea-field" style="width:100%;" placeholder="송서희\tLily\n손하준\tChris\n..." ></textarea>
      <div style="display:flex; gap:10px; justify-content:flex-end;">
        <button id="bulkCancel" class="clear-btn" type="button">Cancel</button>
        <button id="bulkSubmit" class="extract-btn" type="button">Add Students</button>
      </div>
      <div id="bulkMsg" style="color:#a11; font-size:0.98em; margin-top:6px;"></div>
    </div>
  </div>

  <!-- Edit Student Modal -->
  <div id="editModalBg" style="display:none; position:fixed; left:0; top:0; width:100vw; height:100vh; background:rgba(30,41,59,0.18); z-index:9999; align-items:center; justify-content:center;">
    <div id="editModal" style="background:#fff; border-radius:18px; box-shadow:0 8px 32px rgba(30,41,59,0.18); width:50vw; margin:auto; padding:28px 18px 18px 18px; display:flex; flex-direction:column; gap:16px;">
      <h2 style="margin-bottom:8px; color:#19777e; font-size:1.18em; font-weight:800;">Edit Student</h2>
      <div class="row stack" style="gap:0;">
        <div class="input-group">
          <label for="editName">Name</label>
          <input id="editName" class="input-field" placeholder="Student's English Name" />
        </div>
        <div class="input-group">
          <label for="editUsername">Username</label>
          <input id="editUsername" class="input-field" placeholder="Username" />
        </div>
        <div class="input-group">
          <label for="editKoreanName">Korean Name</label>
          <input id="editKoreanName" class="input-field" placeholder="학생의 한국 이름" />
        </div>
        <div class="input-group">
          <label for="editClass">Class</label>
          <input id="editClass" class="input-field" placeholder="Class (e.g. 3-1)" />
        </div>
      </div>
      <div style="display:flex; gap:10px; justify-content:flex-end;">
        <button id="editCancel" class="clear-btn" type="button">Cancel</button>
        <button id="editSubmit" class="extract-btn" type="button">Update</button>
      </div>
      <div id="editMsg" style="color:#a11; font-size:0.98em; margin-top:6px;"></div>
    </div>
  </div>

  <!-- Move Class Up Modal -->
  <div id="renameClassModalBg" style="display:none; position:fixed; left:0; top:0; width:100vw; height:100vh; background:rgba(30,41,59,0.18); z-index:9999; align-items:center; justify-content:center;">
    <div id="renameClassModal" style="background:#fff; border-radius:18px; box-shadow:0 8px 32px rgba(30,41,59,0.18); max-width:420px; width:96vw; margin:auto; padding:28px 18px 18px 18px; display:flex; flex-direction:column; gap:16px;">
      <h2 style="margin-bottom:8px; color:#19777e; font-size:1.18em; font-weight:800;">Move Class Up</h2>
      <div class="input-group">
        <label for="oldClassName">Select Current Class</label>
        <select id="oldClassName" class="select-field"><option value="">Select class...</option></select>
      </div>
      <div class="input-group">
        <label for="newClassName">New Class Name</label>
        <input id="newClassName" class="input-field" placeholder="e.g. 3-A" />
      </div>
      <div style="display:flex; gap:10px; justify-content:flex-end;">
        <button id="renameClassCancel" class="clear-btn" type="button">Cancel</button>
        <button id="renameClassSubmit" class="extract-btn" type="button">Move</button>
      </div>
      <div id="renameClassMsg" style="color:#a11; font-size:0.98em; margin-top:6px;"></div>
    </div>
  </div>

  <!-- Burger menu insertion (same pattern used across tools) -->
  <script type="module">
    import { insertBurgerMenu } from '/Teachers/components/burger-menu.js';
    async function ensureBurgerMenuTemplate() {
      if (!document.getElementById('burger-menu-template')) {
        const resp = await fetch('/Teachers/components/burger-menu.html');
        const html = await resp.text();
        const tempDiv = document.createElement('div');
        tempDiv.innerHTML = html;
        document.body.appendChild(tempDiv.firstElementChild);
      }
    }
    document.addEventListener('DOMContentLoaded', async function() {
      await ensureBurgerMenuTemplate();
      insertBurgerMenu('#burger-menu-mount');
    });
  </script>
  <script type="module" src="./manage_students.js"></script>
</body>
</html>
